---
import {getCollection, render} from 'astro:content';
import ArticleWithTitleLayout from '../../layouts/ArticleWithTitleLayout.astro';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const lessons = await getCollection('lessons');
  return lessons
    .toSorted((a, b) => a.id.localeCompare(b.id))
    .filter((lesson) => lesson.data.published)
    .map((lesson) => ({
      params: {slug: lesson.id},
      props: {lesson},
    }));
}

// 2. For your template, you can get the entry directly from the prop
const {lesson} = Astro.props;
const {Content} = await render(lesson);
---

<style>
  /* 2-level lab counters */
  .lesson {
    counter-reset: step;
  }

  .lesson :global(h2) {
    counter-increment: step;
    counter-reset: substep;
  }

  .lesson :global(h2)::before {
    content: 'Step ' counter(step) ': ';
    font-weight: 700;
    margin-right: 0.35rem;
  }

  .lesson :global(h3) {
    counter-increment: substep;
  }

  .lesson :global(h3)::before {
    content: counter(step) '.' counter(substep) ' ';
    font-weight: 700;
    margin-right: 0.35rem;
  }

  /* Nice anchor jump behavior */
  .lesson :global(h2),
  .lesson :global(h3) {
    scroll-margin-top: 96px;
  }

  /* Heading anchor links (rehype-autolink-headings) */
  .lesson :global(.heading-anchor) {
    opacity: 0;
    margin-left: 0.5rem;
    text-decoration: none;
    font-weight: normal;
  }

  .lesson :global(h2:hover .heading-anchor),
  .lesson :global(h3:hover .heading-anchor) {
    opacity: 1;
  }
</style>
<ArticleWithTitleLayout
  title={lesson.data.title}
  description={lesson.data.description}
>
  <div class="lesson">
    <Content />
  </div>
</ArticleWithTitleLayout>
