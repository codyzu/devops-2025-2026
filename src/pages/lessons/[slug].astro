---
import PageLayout from "../../layouts/PageLayout.astro";
import { getCollection, render } from "astro:content";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const lessons = await getCollection("lessons");
  return lessons
    .filter((lesson) => lesson.data.published)
    .map((lesson) => ({
      params: { slug: lesson.id },
      props: { lesson },
    }));
}

// 2. For your template, you can get the entry directly from the prop
const { lesson } = Astro.props;
const { Content } = await render(lesson);
---

<PageLayout title={lesson.data.title}>
  <style>
    /* 2-level lab counters */
    .lesson {
      counter-reset: step;
    }

    .lesson :global(h2) {
      counter-increment: step;
      counter-reset: substep;
    }

    .lesson :global(h2)::before {
      content: "Step " counter(step) ": ";
      font-weight: 700;
      margin-right: 0.35rem;
    }

    .lesson :global(h3) {
      counter-increment: substep;
    }

    .lesson :global(h3)::before {
      content: counter(step) "." counter(substep) " ";
      font-weight: 700;
      margin-right: 0.35rem;
    }

    /* Nice anchor jump behavior */
    .lesson :global(h2),
    .lesson :global(h3) {
      scroll-margin-top: 96px;
    }
  </style>
  <article class="prose dark:prose-invert p-4 lesson">
    <h1>{lesson.data.title}</h1>
    <p>{lesson.data.description}</p>
    <Content />
  </article>
</PageLayout>
