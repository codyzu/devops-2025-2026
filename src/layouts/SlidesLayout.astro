---
import 'reveal.js/dist/reveal.css';
import 'reveal.js/plugin/highlight/monokai.css';
// Ask Vite for the final built URLs:
import whiteThemeUrl from 'reveal.js/dist/theme/white.css?url';
import HeadContent from '../components/HeadContent.astro';

interface Props {
  title: string;
}

const {title = 'Slides'} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <HeadContent title={title} />
    <link rel="stylesheet" href={whiteThemeUrl} id="reveal-theme" />
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <slot />
      </div>
    </div>

    <script>
      import Reveal from 'reveal.js';
      import Markdown from 'reveal.js/plugin/markdown/markdown.esm.js';
      import Highlight from 'reveal.js/plugin/highlight/highlight.esm.js';
      import Notes from 'reveal.js/plugin/notes/notes.esm.js';
      import whiteThemeUrl from 'reveal.js/dist/theme/white.css?url';
      import blackThemeUrl from 'reveal.js/dist/theme/black.css?url';

      const link = document.getElementById('reveal-theme') as HTMLLinkElement;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

      function applyTheme() {
        link.href = prefersDark.matches ? blackThemeUrl : whiteThemeUrl;
      }

      applyTheme();
      prefersDark.addEventListener('change', applyTheme);

      const root = document.querySelector('.reveal');
      if (!root) throw new Error('Reveal root element not found');

      const deck = new Reveal(root, {
        hash: true,
        slideNumber: true,
        plugins: [Markdown, Highlight, Notes],
      });

      await deck.initialize();
    </script>
  </body>
</html>
